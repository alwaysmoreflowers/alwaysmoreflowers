<!DOCTYPE html>

<html>

<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="icon" href="https://raw.githubusercontent.com/alwaysmoreflowers/amf/master/imgs/favicon.png" type="image/icon type">
	<link rel="stylesheet" type="text/css" href="game-style.css">

	<title>always more flowers</title>

	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script type="text/javascript">

		$(document).ready(function(){
			appendContent();
		});

		var appendContent=function(){
		    fetch('https://alwaysmoreflowers.github.io/amf/liste.json')
		        .then(function (response) {
		            return response.json();
		        })
		        .then(function (data) {
					var Xdata = data;
					console.log(Xdata)
		            sessionStorage.setItem('gameData', JSON.stringify(Xdata));
					launchGame(data);
		        })
		        .catch(function (err) {
		            console.log('error: ' + err);
		        });
		};

		function launchGame(data) {

			sessionStorage.setItem('points', 0);

			$('#content').append("<div id='announcer'>Let the game begin!</div>");
			$('#content').append("<div id='carte' class='carte'><img class='ribbonPhoto' src='imgs/rubanphoto.png'><img src='photos/flower1.png' style='width: 220px; height: 220px;'></div>");
			$('#content').append("<div id='question'>Quelle est cette fleur ?</div>");
			$('#button-block').append("<button id='button1'>Réponse 1</button>");
			$('#button-block').append("<button id='button2'>Réponse 2</button>");
			$('#button-block').append("<button id='button3'>Réponse 3</button>");

			setUpGame();
		}

		function setUpGame() {
			var data = JSON.parse(sessionStorage.getItem('gameData'));
			console.log(data);

			var randPhoto = Math.floor(Math.random() * data.length);
		
			var randPlace = (Math.floor(Math.random() * 3) + 1);

			if (randPlace == 1) {
				var bPlacing = [2, 3];
			} else if (randPlace == 2) {
				var bPlacing = [1, 3];
			} else if (randPlace == 3) {
				var bPlacing = [1, 2];
			}

			buttonText1 = data[Math.floor(Math.random() * data.length)].nom;
			buttonText2 = data[Math.floor(Math.random() * data.length)].nom;

			while (data[randPhoto].nom == "n / a" || data[randPhoto].nomscient == "n / a") {
				randPhoto = Math.floor(Math.random() * data.length);
			}

			while (buttonText1 == "n / a" || buttonText2 == "n / a" || buttonText1 == data[randPhoto].nom || buttonText2 == data[randPhoto].nom) {
				buttonText1 = data[Math.floor(Math.random() * data.length)].nom;
				buttonText2 = data[Math.floor(Math.random() * data.length)].nom;
			}

			document.getElementById("carte").innerHTML = "<div class='carte'><img class='ribbonPhoto' src='imgs/rubanphoto.png'><img src='photos/flower" + data[randPhoto].numero + ".png' style='width: 220px; height: 220px;'></div>";

			document.getElementById("button" + randPlace).innerHTML = "<button onclick = 'answer(true)' id='button1'>" + data[randPhoto].nom + "</button>";

			document.getElementById("button" + bPlacing[0]).innerHTML = "<button onclick = 'answer(false)' id='button" + bPlacing[0] + "'>" + buttonText1 + "</button>";
			document.getElementById("button" + bPlacing[1]).innerHTML = "<button onclick = 'answer(false)' id='button" + bPlacing[1] + "'>" + buttonText2 + "</button>";
		}

		function answer(result) {
			if (result) {
				console.log("Plus un point pour Griffondor !");

				var points = sessionStorage.getItem('points');
				points++;
				sessionStorage.setItem('points', points);

				document.getElementById("announcer").innerHTML = "<div id='announcer'>Vous avez maintenant " + points + " points</div>";

				setUpGame();
			} else {
				console.log("Plus un point pour Poufsouffle !");
				document.getElementById("announcer").innerHTML = "<div id='announcer'>Vous avez perdu, retentez votre chance !</div>";
				sessionStorage.setItem('points', 0);
				setUpGame();
			}
		}

		function slideUp(string) {
			document.getElementById(string).style.animation = "slide 0.6s linear";
		}

		function slideDown(string) {
			document.getElementById(string).style.animation = "slide2 0.6s linear";
		}

	</script>
</head>

<body>
	
	<div id="header">always more flowers</div>

	<div id="ribbonTop">
	    <img id="ribbonImg" src="imgs/ruban1.png">
	    <a id="ribbonText">I want more flowers!</a>
	</div>

	<div id="menu">
		<div id="home-button" onmouseover="slideUp('home-slider1')" onmouseout="slideDown('home-slider1')">
			<a href="index.html">
				<div id="home-slider1"><img class="menu-button-img" src="imgs/thomebutton.png"></div>
				<div id="home-slider2"><img class="menu-button-img" src="imgs/thomebutton.png"></div>
			</a>
		</div>
	</div>

	<div id="content">
	</div>
	<div id="button-block">
	</div>

</body>

</html>